import extend from"extend";import Emitter from"../core/emitter";import BaseTheme,{BaseTooltip}from"./base";import LinkBlot from"../formats/link";import Picker from"../ui/picker";import{Range}from"../core/selection";const TOOLBAR_CONFIG=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class SnowTheme extends BaseTheme{constructor(e,t){null!=t.modules.toolbar&&null==t.modules.toolbar.container&&(t.modules.toolbar.container=TOOLBAR_CONFIG),super(e,t),this.quill.container.classList.add("ql-snow")}extendToolbar(i){i.container.classList.add("ql-snow"),this.buildButtons([].slice.call(i.container.querySelectorAll("button"))),this.buildPickers([].slice.call(i.container.querySelectorAll("select"))),this.tooltip=new SnowTooltip(this.quill,this.options.bounds),i.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(e,t){i.handlers.link.call(i,!t.format.link)})}}SnowTheme.DEFAULTS=extend(!0,{},BaseTheme.DEFAULTS,{modules:{toolbar:{handlers:{link:function(t){if(t){t=this.quill.getSelection();if(null!=t&&0!=t.length){let e=this.quill.getText(t);/^\S+@\S+\.\S+$/.test(e)&&0!==e.indexOf("mailto:")&&(e="mailto:"+e),this.quill.theme.tooltip.edit("link",e)}}else this.quill.format("link",!1)}}}}});class SnowTooltip extends BaseTooltip{constructor(e,t){super(e,t),this.preview=this.root.querySelector("a.ql-preview")}listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{null!=this.linkRange&&(this.restoreFocus(),this.quill.formatText(this.linkRange,"link",!1,Emitter.sources.USER),delete this.linkRange),e.preventDefault(),this.hide()}),this.quill.on(Emitter.events.SELECTION_CHANGE,e=>{if(null!=e){if(0===e.length){var[t,i]=this.quill.scroll.descendant(LinkBlot,e.index);if(null!=t)return this.linkRange=new Range(e.index-i,t.length()),e=LinkBlot.formats(t.domNode),this.preview.textContent=e,this.preview.setAttribute("href",e),this.show(),void this.position(this.quill.getBounds(this.linkRange))}this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}SnowTooltip.TEMPLATE=['<a class="ql-preview" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");export default SnowTheme;