import extend from"extend";import Emitter from"../core/emitter";import Keyboard from"../modules/keyboard";import BaseTheme,{BaseTooltip}from"./base";import icons from"../ui/icons";import{Range}from"../core/selection";const TOOLBAR_CONFIG=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class BubbleTheme extends BaseTheme{constructor(t,e){null!=e.modules.toolbar&&null==e.modules.toolbar.container&&(e.modules.toolbar.container=TOOLBAR_CONFIG),super(t,e),this.quill.container.classList.add("ql-bubble")}extendToolbar(t){this.tooltip=new BubbleTooltip(this.quill,this.options.bounds),this.tooltip.root.appendChild(t.container),this.buildButtons([].slice.call(t.container.querySelectorAll("button"))),this.buildPickers([].slice.call(t.container.querySelectorAll("select")))}}BubbleTheme.DEFAULTS=extend(!0,{},BaseTheme.DEFAULTS,{modules:{toolbar:{handlers:{link:function(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});class BubbleTooltip extends BaseTooltip{constructor(t,e){super(t,e),this.quill.on(Emitter.events.EDITOR_CHANGE,(t,e)=>{var o;t===Emitter.events.SELECTION_CHANGE&&(null!=e&&0<e.length?(this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=this.root.offsetWidth+"px",1===(t=this.quill.scroll.lines(e.index,e.length)).length?this.position(this.quill.getBounds(e)):(o=(t=t[t.length-1]).offset(this.quill.scroll),t=Math.min(t.length()-1,e.index+e.length-o),e=this.quill.getBounds(new Range(o,t)),this.position(e))):document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide())})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",t=>{this.root.classList.remove("ql-editing")}),this.quill.on(Emitter.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{var t;this.root.classList.contains("ql-hidden")||null!=(t=this.quill.getSelection())&&this.position(this.quill.getBounds(t))},1)})}cancel(){this.show()}position(t){t=super.position(t);if(0===t)return t;var e=this.root.querySelector(".ql-tooltip-arrow");e.style.marginLeft="",e.style.marginLeft=-1*t-e.offsetWidth/2+"px"}}BubbleTooltip.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");export default BubbleTheme;